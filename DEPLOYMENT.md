# Deployment Guide for Render

## Changes Made for Deployment

### Backend Changes

1. **Dependencies**
   - Removed `gevent` dependency (compatibility issues)
   - Using `sync` worker class in gunicorn instead

2. **Configuration Updates**
   - Fixed PostgreSQL URL format for Render (`postgres://` â†’ `postgresql://`)
   - Added environment-based CORS configuration
   - Separated production and development settings

3. **Gunicorn Configuration**
   - Updated to use `PORT` environment variable
   - Limited workers for free tier compatibility
   - Increased timeout for production workloads

4. **WSGI Configuration**
   - Uses environment variables for configuration
   - Proper production/development separation

### Frontend Changes

1. **Build Configuration**
   - Added `vite.config.js` for optimized builds
   - Added production start script
   - Updated environment variable handling

2. **API Configuration**
   - Supports both `VITE_API_URL` and `REACT_APP_API_URL`
   - Fallback to localhost for development

### Render Configuration

1. **Backend Service**
   - Updated to use environment-specific start command
   - Added all required environment variables
   - Proper database and Redis connections

2. **Frontend Service**
   - Changed to static site deployment
   - Uses `dist` folder for built assets
   - Correct environment variable setup

## Environment Variables Required

### Backend
- `FLASK_ENV=production`
- `SECRET_KEY` (auto-generated by Render)
- `JWT_SECRET_KEY` (auto-generated by Render)
- `DATABASE_URL` (from PostgreSQL service)
- `REDIS_URL` (from Redis service)
- `GEMINI_API_KEY` (manual setup required)

### Frontend
- `VITE_API_URL=https://ecommerce-backend.onrender.com/api`

## Deployment Steps

1. **Push Changes to Git**
   ```bash
   git add .
   git commit -m "Fix deployment configuration for Render"
   git push origin main
   ```

2. **Deploy on Render**
   - Connect your GitHub repository
   - Use the `render.yaml` configuration
   - Add `GEMINI_API_KEY` manually in environment variables

3. **Verify Deployment**
   - Check backend health: `https://your-backend.onrender.com/`
   - Check frontend: `https://your-frontend.onrender.com/`

## Common Issues and Solutions

### Database Connection Issues
- Ensure DATABASE_URL uses `postgresql://` prefix
- Check database service is running

### CORS Issues
- Frontend domain must match CORS settings
- Check environment variable configuration

### Build Failures
- Check all dependencies are in requirements.txt
- Verify Python version compatibility

### Static File Issues
- Frontend builds to `dist` folder
- Ensure staticPublishPath is correct

## Testing Locally

Run the health check script:
```bash
cd backend
python test_health.py
```

This validates the configuration works before deployment.
